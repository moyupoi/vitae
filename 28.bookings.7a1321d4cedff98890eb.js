webpackJsonp([28],{475:function(e,t,a){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}function n(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=m.default.load("token");return(0,d.default)({},_.CALL_API,{endpoint:h.default.api_root_v1+"/bookings?page="+e,method:"GET",headers:(0,f.default)(h.default.headers,{Authorization:"Bearer "+t}),types:[k,{type:E,payload:function(e,t,a){return a.json()}},y]})}function r(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:B,t=arguments[1],a=v[t.type];return a?a(e,t):e}Object.defineProperty(t,"__esModule",{value:!0}),t.actions=t.FETCH_BOOKINGS_FAILURE=t.FETCH_BOOKINGS_SUCCESS=t.FETCH_BOOKINGS_REQUEST=void 0;var s,i=a(6),l=o(i),u=a(8),d=o(u),c=a(194),f=o(c);t.fetchBookings=n,t.default=r;var _=a(41),p=a(17),m=o(p),g=a(29),h=o(g),k=t.FETCH_BOOKINGS_REQUEST="FETCH_BOOKINGS_REQUEST",E=t.FETCH_BOOKINGS_SUCCESS="FETCH_BOOKINGS_SUCCESS",y=t.FETCH_BOOKINGS_FAILURE="FETCH_BOOKINGS_FAILURE",v=(t.actions={fetchBookings:n},s={},(0,d.default)(s,k,function(e,t){return(0,l.default)({},e,{isFetching:!0,error:{},items:[]})}),(0,d.default)(s,E,function(e,t){return(0,l.default)({},e,{isFetching:!1,error:{},lastUpdate:Date.now(),items:t.payload})}),(0,d.default)(s,y,function(e,t){return(0,l.default)({},e,{isFetching:!1,error:{},items:[]})}),s),B={isFetching:!1,error:{},items:[]}},736:function(e,t,a){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var n=a(11),r=o(n),s=a(2),i=o(s),l=a(12),u=o(l),d=a(4),c=o(d),f=a(3),_=o(f),p=a(1),m=o(p),g=a(125),h=o(g),k=a(44),E=o(k),y=a(62),v=o(y),B=a(52),b=a(1122),T=o(b),S=a(15),N=function(e){function t(e){(0,i.default)(this,t);var a=(0,c.default)(this,(t.__proto__||(0,r.default)(t)).call(this,e));return a.goPayBtn=a.goPayBtn.bind(a),a}return(0,_.default)(t,e),(0,u.default)(t,[{key:"componentWillMount",value:function(){var e=this.props,t=e.user,a=e.setTitle;a("我的订单"),(0,B.bindWechat)("我的订单 - 住百家","不住酒店,住百家"),t.signed||"wx_menu"!==this.props.location.query.from?t.signed||this.context.router.push("/users/sign_in"):this.context.router.push("/users/wx_sign?success_to=bookings"),this.state={bookings:[],page:1,firstTime:!0,count:1}}},{key:"componentDidMount",value:function(){var e=this.props.fetchBookings;e()}},{key:"componentWillReceiveProps",value:function(e){void 0!==e.bookings.lastUpdate&&e.bookings.lastUpdate!==this.props.bookings.lastUpdate&&(this.setState({bookings:(0,h.default)(this.state.bookings,{$push:[e.bookings.items]}),page:this.state.page+1}),this.state.firstTime&&(this.props.fetchBookings(2),this.setState({firstTime:!1})))}},{key:"fetchMoreBookings",value:function(e){var t=this.props.fetchBookings;t(e),this.setState({count:this.state.count+1})}},{key:"handClick",value:function(e){window.location.href="/customer/bookings/"+e,(0,S.saBtnClick)("查看订单详情","订单页")}},{key:"goPayBtn",value:function(){(0,S.saBtnClick)("去支付","订单页")}},{key:"render",value:function(){var e=this,t=this.props.bookings,a=t.error,o=t.isFetching,n=t.items,r=!0;this.state.bookings[this.state.count]&&0===this.state.bookings[this.state.count].length&&(r=!1);for(var s=[],i=0;i<this.state.count;i++)this.state.bookings[i]&&(s=(0,h.default)(s,{$push:this.state.bookings[i]}));return m.default.createElement("div",{style:{minHeight:"3.4rem"}},o&&0===n.length&&m.default.createElement("div",{className:"loading"},m.default.createElement(v.default,null)),!o&&!a&&m.default.createElement("h3",null,"网络异常，刷新重新获取数据"),0===s.length&&m.default.createElement("div",{className:"without-bookings"},m.default.createElement("p",null,"您暂时还没有订单哦")),s.length>0&&m.default.createElement("div",{className:T.default.myorderWrap,style:{opacity:o?.5:1}},m.default.createElement(E.default,{title:"我的订单 - 住百家"}),m.default.createElement("ul",null,s.map(function(t,a){return m.default.createElement("li",{key:a,onClick:function(){return e.handClick(t.bill_no)}},m.default.createElement("div",{className:T.default.orderId},"订单编号：",t.bill_no,m.default.createElement("span",{className:T.default.orderStatus},t.status_text)),m.default.createElement("div",{className:T.default.paymentorderMain},m.default.createElement("div",{className:T.default.orderImg},m.default.createElement("img",{src:t.offer.primary_image.thumbnail_url})),m.default.createElement("div",{className:T.default.orderInfo},m.default.createElement("h4",null,t.offer.name),m.default.createElement("p",{className:T.default.orderTime},"入住日期：",t.checkin_date),m.default.createElement("p",{className:T.default.orderTime},"退房日期：",t.checkout_date),m.default.createElement("p",{className:T.default.orderPeoplenum},"入住人数：",m.default.createElement("i",null,t.guests_count),"人"))),m.default.createElement("div",{className:T.default.paymentOrderPrice},m.default.createElement("span",{className:T.default.totalPrice},"总价：",m.default.createElement("em",null,"￥",t.total_price)),t.can_pay&&m.default.createElement("a",{href:"/payments/pay/"+t.bill_no,onClick:e.goPayBtn},"去支付"),!t.can_pay&&m.default.createElement("a",{href:"javascript:void(0)"},"查看订单")))}))),r&&m.default.createElement("div",{className:T.default.loadMoreBtn,onClick:function(){return e.fetchMoreBookings(e.state.page)}},"加载更多",m.default.createElement("i",{className:T.default.loadMoreBtnArrow})))}}]),t}(p.Component);N.propTypes={bookings:m.default.PropTypes.object.isRequired,params:m.default.PropTypes.object.isRequired,fetchBookings:m.default.PropTypes.func.isRequired,user:m.default.PropTypes.object.isRequired,setTitle:m.default.PropTypes.func.isRequired},N.contextTypes={router:m.default.PropTypes.object.isRequired},t.default=N},737:function(e,t,a){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var n=a(28),r=a(475),s=a(736),i=o(s),l=a(42),u={fetchBookings:r.fetchBookings,setTitle:l.setTitle},d=function(e){return{bookings:e.bookings,user:e.user}};t.default=(0,n.connect)(d,u)(i.default)},1122:function(e,t){e.exports={myorderWrap:"Bookings__myorderWrap___qZsRb",orderId:"Bookings__orderId___3QIOH",orderStatus:"Bookings__orderStatus___sW3mg",paymentorderMain:"Bookings__paymentorderMain___1clGd",orderImg:"Bookings__orderImg___Vyh7i",orderInfo:"Bookings__orderInfo___1Lrvb",paymentOrderPrice:"Bookings__paymentOrderPrice___1ALgz",loadMoreBtn:"Bookings__loadMoreBtn___Nc409",loadMoreBtnArrow:"Bookings__loadMoreBtnArrow___1NFQj"}}});